import{X as Z,a as _,a3 as L,m as k,i as h,t as b,Z as V,k as F,c as x,_ as v,g as E,P as I,u as z,h as P,j as T,s as y}from"./index-5e0fdc25.js";const R=b('<form><button type="submit">'),A=V();function M(e){const r=e.errorTransfer??!1,u=e.errorAlign??"right",t=()=>F(e,"cm-form",{"cm-form-inline":e.inline}),[i,l]=Z(e,["labelWidth","form","inline","classList","class","onChange","children","onBeforeSubmit"]),g=(o,d)=>{i.form[o]=d,i.onChange&&i.onChange(o,d)},$={labelWidth:i.labelWidth,inline:i.inline,form:i.form,errorTransfer:r,errorAlign:u,onChange:g},s=o=>(o.preventDefault(),i.onBeforeSubmit?i.onBeforeSubmit():!1);return _(A.Provider,{value:$,get children(){const o=R(),d=o.firstChild;return o.addEventListener("submit",s),L(o,k({get classList(){return t()}},l,{get autocomplete(){return e.autocomplete}}),!1,!0),d.style.setProperty("display","none"),h(o,()=>i.children,null),o}})}function B(){return{required(e){return e==null?!1:e instanceof Array?e.length>0:`${e}`.length>0},email(e){return/^[a-zA-Z0-9.!#$%&\'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e)},url(e){return new RegExp("^(?:(?:(?:https?|ftp):)?//)(?:S+(?::S*)?@)?(?:(?!(?:10|127)(?:.d{1,3}){3})(?!(?:169.254|192.168)(?:.d{1,3}){2})(?!172.(?:1[6-9]|2d|3[0-1])(?:.d{1,3}){2})(?:[1-9]d?|1dd|2[01]d|22[0-3])(?:.(?:1?d{1,2}|2[0-4]d|25[0-5])){2}(?:.(?:[1-9]d?|1dd|2[0-4]d|25[0-4]))|(?:(?:[a-z¡-￿0-9]-*)*[a-z¡-￿0-9]+)(?:.(?:[a-z¡-￿0-9]-*)*[a-z¡-￿0-9]+)*(?:.(?:[a-z¡-￿]{2,})).?)(?::d{2,5})?(?:[/?#]S*)?$","i").test(e)},minLength(e,r){return(e?e.length:0)>=r},maxLength(e,r){return(e?e.length:0)<=r},min(e,r){return e>=r},max(e,r){return e<=r},range(e,r){return e>=r[0]&&e<=r[1]},price(e){return/^\d+(.\d{1,2})?$/.test(e)},idCard(e){return/(^\d{15}$)|(^\d{18}$)|(^\d{17}(\d|X|x)$)/.test(e)},noSpecial(e){return/^[\u4E00-\u9FA5A-Za-z0-9_&]+$/.test(e)},userName(e){return/^[\u4E00-\u9FA5A-Za-z0-9*]+$/.test(e)},mobile(e){return/^1[3-8][0-9]{9}$/.test(e)},ip(e){return/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/.test(e)},equalTo(e,r,u){const t=u[r];return e===t}}}const W=b('<div class="cm-form-item-element">'),D=b('<div><label class="cm-form-label">'),N=b('<div class="cm-form-item-element"><div class="cm-form-item-error-tip">'),S=V();function G(e){const[r,u]=x(null),t=v(A),i=B();let l;const g=e.errorTransfer??t?.errorTransfer??!1,$=e.errorAlign??t?.errorAlign??"right",s=e.name;let o=!1;s&&t&&t.form.getValidation&&t.form.getValidation(s)&&(o=t.form.getValidation(s).required),e.rules&&(o=e.rules.required);const d=()=>F(e,"cm-form-item",{"cm-form-item-error":r(),"cm-form-item-inline":e.inline||t?.inline,"cm-form-item-required":o}),C=async m=>{if(l){const f=l.getBoundingClientRect();if(f.width===0||f.height===0)return!0}if(s&&t&&t.form.getValidation&&t.form.getValidation(s)||t&&e.rules){const f=t.form.getValidation(s)||e.rules,n=t.form.getMessage(s)||e.messages;if(f.required){const a=await i.required(m,f.required,t.form);if(!a)return u(n?n.required:""),a}for(let a in f)if(a!=="required"){if(i[a]){const c=await i[a](m,f[a],t.form);if(!c)return u(n?n[a]:""),c}if(f[a]&&typeof f[a]=="function"){const c=await f[a](m,t.form);if(!c)return u(n?n[a]:""),c}}return u(null),!0}return!0};e.name||console.warn("formItem needs name property to check valid");const w=()=>{u(null)};return e.name&&t?.form.setCheckValid&&t.form.setCheckValid(e.name,C),e.name&&t?.form.setClearValid&&t.form.setClearValid(e.name,w),_(S.Provider,{get value(){return{name:e.name}},get children(){const m=D(),f=m.firstChild;return h(f,()=>e.label),h(m,_(E,{when:g,get fallback(){return(()=>{const n=N(),a=n.firstChild,c=l;return typeof c=="function"?z(c,n):l=n,h(n,()=>e.children,a),h(a,r),n})()},get children(){return _(I,{class:"cm-form-item-error-popover",arrow:!0,align:$,get disabled(){return!r()},get content(){return r()},get children(){const n=W(),a=l;return typeof a=="function"?z(a,n):l=n,h(n,()=>e.children),n}})}}),null),P(n=>{const a=d(),c=e.style,q={width:t?.labelWidth+"px",...e.labelStyle};return n._v$=T(m,a,n._v$),n._v$2=y(m,c,n._v$2),n._v$3=y(f,q,n._v$3),n},{_v$:void 0,_v$2:void 0,_v$3:void 0}),m}})}const X=()=>v(S);function H(e,r,u){arguments.length===2&&(u=r,r="value");let t,i;e[r]&&e[r].length===2&&typeof e[r][0]=="function"?(t=e[r][0],i=e[r][1]):[t,i]=x(e[r]||u);const l=v(A),g=l?.form.getFormData?l.form.getFormData():{},s=X()?.name||e.name,o=g&&s?g[s]:void 0;return o!=null&&!e.notCreateFiled&&i(o),l&&l.form&&s&&!e.notCreateFiled&&l.form.bindController(s,t,i),[t,C=>{i(C),e.notCreateFiled||l?.onChange(s,C)}]}export{M as F,G as a,H as c,B as u};
