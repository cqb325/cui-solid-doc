import{a5 as H,c as x,E as I,U as K,i as a,a as m,u as k,F as T,a4 as y,f as Q,h as f,g as W,O as Y,t as _,J as P,N as Z,x as tt,j as C,s as et,k as nt}from"./index-69f0698f.js";const O=_("<div>"),it=_('<div><div class="cm-index-list-list"></div><div class="cm-index-list-nav">'),ot=_("<dl><dt>"),ct=_("<dd>");function lt(s){const S=()=>s.promote??!0,[E,M]=H(s,"value",[]),[q,B]=x(""),[D,w]=x(!1),[N,R]=x(""),[A,L]=I({list:[],listMap:{}});let d={},u;const $={};K(()=>{const i=[];d={};const e={};s.data.forEach(n=>{(n.id===void 0||n.id===null)&&(n.id=P());const o={id:n.id};d[n.id]=n,e[n.id]=o,i.push(o),n.children&&(o.children=[],n.children.forEach(t=>{(t.id===void 0||t.id===null)&&(t.id=P()),d[t.id]=t;const c={id:t.id};e[t.id]=c,o.children.push(c)}))}),L({list:i,listMap:e})});const U=()=>nt(s,"cm-index-list",{"cm-index-list-border":s.border}),F=i=>{if(!s.selectable)return;const e=E(),n=i.id;if(i.active){const o=e.indexOf(n);e.splice(o,1),M(e)}else e.push(n),M([...e]);s.onChange&&s.onChange(E()),L("listMap",i.id,"active",!i.active)};let p=null;const V=(i,e,n)=>{n.preventDefault&&n.preventDefault(),n.stopPropagation&&n.stopPropagation();const o=document.querySelector(i);if(o){S()&&(R(e),w(!0),p&&clearTimeout(p),p=setTimeout(()=>{j()},1e3));const t=o.getBoundingClientRect().top,c=u.getBoundingClientRect().top,l=t-c;u.scrollTo({top:u.scrollTop+l,behavior:"smooth"})}},j=()=>{w(!1)},J=()=>{const i=u.scrollTop,e=X(i);B(e)},X=i=>{let e="",n=Number.MAX_VALUE;for(const o in $){const t=Math.abs($[o]-i);n>t&&(n=t,e=o)}return e},b=(i,e)=>{queueMicrotask(()=>{$[e]=i.offsetTop})},z=()=>({"cm-index-list-promote":!0,"cm-index-list-promote-show":D()});return(()=>{const i=it(),e=i.firstChild,n=e.nextSibling;e.addEventListener("scroll",J);const o=u;return typeof o=="function"?k(o,e):u=e,a(e,m(T,{get each(){return A.list},children:t=>{const c=d[t.id];return(()=>{const l=ot(),g=l.firstChild;return k(r=>{b(r,t.id)},l),a(g,()=>c.name),a(l,m(T,{get each(){return t.children},children:r=>{const h=d[r.id];return(()=>{const v=ct();return y(v,"click",F.bind(null,r),!0),a(v,(()=>{const G=Q(()=>!!s.renderItem);return()=>G()?s.renderItem(h,r.active):h.name})()),f(()=>Z(v,r.active?"active":"")),v})()}}),null),f(()=>tt(l,"id",`cm_index_list_${t.id}`)),l})()}})),a(n,m(T,{get each(){return A.list},children:t=>{const c=d[t.id],l=()=>q()===t.id,g=()=>({"cm-index-list-nav-item":!0,active:l()});return(()=>{const r=O();return y(r,"click",V.bind(null,`#cm_index_list_${t.id}`,c.id),!0),a(r,()=>c.id),f(h=>C(r,g(),h)),r})()}})),a(i,m(W,{get when(){return S()},get children(){const t=O();return a(t,N),f(c=>C(t,z(),c)),t}}),null),f(t=>{const c=U(),l=s.style;return t._v$=C(i,c,t._v$),t._v$2=et(i,l,t._v$2),t},{_v$:void 0,_v$2:void 0}),i})()}Y(["click"]);export{lt as I};
