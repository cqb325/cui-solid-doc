import{c as $,d as x,f as _,i as f,a as o,I as S,D as T,h as M,t as m,j as R,s as j,k as A}from"./index-69f0698f.js";import{T as L}from"./index-3ce0eef9.js";import{V as y}from"./Value-9535b38f.js";import{c as z}from"./createField-bb19acb2.js";const D=m('<div tabindex="1">'),H=m('<div class="cm-tree-select-wrap">'),I={All:0,Half:1,Leaf:2,Shallow:3};function W(e){const[i,c]=z(e,e.multi?[]:""),[h,d]=$(""),C=e.align??"bottomLeft";let n;const r=I[e.mode??"Half"],g=e.checkRelation??"related",k=()=>A(e,"cm-tree-select",{"cm-tree-select-disabled":e.disabled,[`cm-tree-select-${e.size}`]:e.size}),v=t=>{e.multi||e.onChange&&e.onChange(t.id)},b=t=>{g==="related"?(c(s()),e.onChange&&e.onChange(s())):(c(t),e.onChange&&e.onChange(t))},V=()=>{const t=e.multi?[]:"";c(t),e.onChange&&e.onChange(t)},w=(t,a)=>{const l=i();l.splice(l.indexOf(t.id),1),c([...l])},s=()=>{let t=[];switch(r){case 0:{t=n.getAllChecked();break}case 1:{t=n.getHalfChecked();break}case 2:{t=n.getChildChecked();break}case 3:{t=n.getShallowChecked();break}}return t};return x(()=>{const t=i();e.multi&&t.join(",")===s().join(",")||e.multi&&(g==="unRelated"?n.setValue(t):(r===0&&n.setValue(t),r===1&&n.setValue(t),r===2&&n.setValue(t),r===3&&(t.join(",")===s().join(",")?n.setValue(n.getAllChecked()):n.setValue(n.getIfSets(t)))))}),_(()=>{let t=i();if(e.multi){if(typeof t=="string"){t=t.split(","),c(t);return}setTimeout(()=>{const a=g==="related"?s():n.getAllChecked(),l=n.getAllCheckedData(a);d(l)})}else setTimeout(()=>{const a=n.getSelectNode();d(a?a.title:"")})}),e.ref&&e.ref({...n}),(()=>{const t=D();return f(t,o(T,{get transfer(){return e.transfer},fixWidth:!0,align:C,get disabled(){return e.disabled},trigger:"click",get menu(){return(()=>{const a=H();return f(a,o(L,{get data(){return e.data},get multi(){return e.multi},onSelect:v,onChange:b,ref(l){const u=n;typeof u=="function"?u(l):n=l},get value(){return i()},get selected(){return e.multi?"":[i,c]},get checkRelation(){return e.checkRelation}})),a})()},get children(){return o(y,{get text(){return h()},get multi(){return e.multi},get showMax(){return e.showMax},get disabled(){return e.disabled},get showMore(){return e.showMore},get valueClosable(){return e.valueClosable},get clearable(){return e.clearable},onClear:V,get prepend(){return e.prepend},get size(){return e.size},get icon(){return o(S,{name:"chevron-down"})},onClose:w})}})),M(a=>{const l=k(),u=e.style;return a._v$=R(t,l,a._v$),a._v$2=j(t,u,a._v$2),a},{_v$:void 0,_v$2:void 0}),t})()}export{W as T};
