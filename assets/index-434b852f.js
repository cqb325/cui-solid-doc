import{O as R,i as o,a as u,T as P,g as L,I as _,h as k,x as y,B as re,F as X,t as w,a4 as le,c as I,E as ae,d as ie,a8 as se,J as p,Y as D,a9 as ce,u as ue,j as oe,s as de,k as fe}from"./index-69f0698f.js";import{P as me}from"./index-227a106d.js";function ve(e,i,f){const s=`fail to post ${e} ${f.status}'`,c=new Error(s);return c.status=f.status,c.method="post",c.url=e,c}function H(e){const i=e.responseText||e.response;if(!i)return i;try{return JSON.parse(i)}catch{return i}}function J(e){if(typeof XMLHttpRequest>"u")return;const i=new XMLHttpRequest,f=e.action;i.upload&&(i.upload.onprogress=function(d){d.total>0&&(d.percent=d.loaded/d.total*100),e.onProgress(d)});const s=new FormData;e.data&&Object.keys(e.data).map(l=>{s.append(l,e.data[l])}),s.append(e.filename,e.file),i.onerror=function(d){e.onError(d)},i.onload=function(){if(i.status<200||i.status>=300)return e.onError(ve(f,e,i),H(i));e.onSuccess(H(i))},i.open("post",f,!0),e.withCredentials&&"withCredentials"in i&&(i.withCredentials=!0);const c=e.headers||{};for(const l in c)Object.prototype.hasOwnProperty.call(c,l)&&c[l]!==null&&i.setRequestHeader(l,c[l]);i.send(s)}const ge=w('<div class="cm-upload-list-title">'),he=w('<ul class="cm-upload-list"><div class="cm-upload-files">'),$e=w('<img class="cm-upload-file-preview-img" alt="">'),we=w('<div class="cm-upload-error">'),Le=w('<li class="cm-upload-file-card"><div class="cm-upload-file-preview"></div><div class="cm-upload-file-card-body"><div class="cm-upload-file-card-info"><span class="cm-upload-file-card-info-name"></span><span></span></div></div><div class="cm-upload-file-control">');function _e(e){const i=s=>{const c=s.name.split(".").pop().toLocaleLowerCase()||"";let l="file-text";return["gif","jpg","jpeg","png","bmp","webp"].indexOf(c)>-1&&(l="image"),["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(c)>-1&&(l="film1"),["mp3","wav","wma","ogg","aac","flac"].indexOf(c)>-1&&(l="music"),l},f=s=>{if(s<1024)return s+"B";if(s<1048576)return Math.round(s/1024*10)/10+"KB";if(s<1073741824)return Math.round(s/1024/1024*10)/10+"MB";if(s<1099511627776)return Math.round(s/1024/1024/1024*10)/10+"GB"};return(()=>{const s=he(),c=s.firstChild;return o(s,u(L,{get when(){return e.files&&e.files.length},get children(){const l=ge();return o(l,u(P,{type:"secondary",children:"已上传文件"}),null),o(l,u(P,{type:"primary",class:"cm-upload-clear",get onClick(){return e.onClear},children:"清空"}),null),l}}),c),o(c,u(X,{get each(){return e.files},children:l=>(()=>{const d=Le(),h=d.firstChild,m=h.nextSibling,v=m.firstChild,$=v.firstChild,C=$.nextSibling,S=m.nextSibling;return o(h,u(L,{get when(){return l.url},get fallback(){return u(_,{get name(){return i(l)},size:20})},get children(){const g=$e();return g.$$click=()=>{e.onPreview&&e.onPreview(l)},k(()=>y(g,"src",l.url)),g}})),o($,()=>l.name),o(C,()=>f(l.size)),o(m,u(L,{get when(){return l.showProgress&&l.percentage!==100},get children(){return u(me,{strokeWidth:4,get value(){return l.percentage},hidePercent:!0})}}),null),o(m,u(L,{get when(){return l.status==="fail"},get children(){const g=we();return o(g,u(_,{name:"alert-circle",size:12}),null),o(g,u(P,{type:"error",size:"small",class:"cm-upload-error-text",children:"上传失败"}),null),o(g,u(P,{type:"primary",class:"cm-upload-retry",size:"small",onClick:()=>{e.onRetry&&e.onRetry(l)},children:"重试"}),null),g}}),null),o(S,u(re,{size:"small",ghost:!0,get icon(){return u(_,{name:"x"})},onClick:()=>{e.onRemove&&e.onRemove(l)}})),k(()=>y($,"title",l.name)),d})()})),s})()}R(["click"]);const ye=w('<ul class="cm-upload-list cm-upload-picture-list"><li class="cm-upload-picture-add">'),Ce=w('<li class="cm-upload-picture-card"><img class="cm-upload-picture-img" alt=""><div class="cm-upload-picture-remove"></div><div class="cm-upload-picture-preview">');function be(e){return(()=>{const i=ye(),f=i.firstChild;return o(i,u(X,{get each(){return e.files},children:s=>(()=>{const c=Ce(),l=c.firstChild,d=l.nextSibling,h=d.nextSibling;return d.$$click=()=>{e.onRemove&&e.onRemove(s)},o(d,u(_,{name:"x-circle"})),h.$$click=()=>{e.onPreview&&e.onPreview(s)},o(h,u(_,{name:"eye",size:20})),k(()=>y(l,"src",s.url)),c})()}),f),le(f,"click",e.onClick,!0),o(f,()=>e.children),i})()}R(["click"]);const Ee=w('<div class="cm-upload-out">'),Pe=w('<div><input class="cm-upload-input" type="file">');function xe(e){const[i,f]=I(!1),[s,c]=I(!1),l=e.format??[],d=[],h=e.type??"select",[m,v]=ae({fileList:d,previewUrl:""});let $={};const C=e.name??"file",S=()=>fe(e,"cm-upload",{"cm-upload-select":h==="select","cm-upload-drag":h==="drag","cm-upload-dragOver":h==="drag"&&i()});ie(()=>{if(e.defaultFileList){const t=e.defaultFileList.map(n=>(n.uid||(n.uid=p()),n));v("fileList",t)}});const g=t=>{const n=t.target.files;n&&(x(n),E.value=null)},x=t=>{let n=Array.prototype.slice.call(t);e.multiple||(n=n.slice(0,1)),n.length!==0&&n.forEach(a=>{G(a)})},G=async t=>{if(!e.beforeUpload)return b(t);const n=e.beforeUpload(t);typeof n=="object"&&n.then?n.then(a=>{Object.prototype.toString.call(a)==="[object File]"?b(a):b(t)},()=>{}):n!==!1&&b(t)},b=t=>{if(l.length){const n=t.name.split(".").pop().toLocaleLowerCase();if(!l.some(r=>r.toLocaleLowerCase()===n))return e.onFormatError&&e.onFormatError(t,d),!1}if(e.maxSize&&t.size>e.maxSize*1024)return e.onExceededSize&&e.onExceededSize(t,d),!1;K(t),J({headers:e.headers,withCredentials:e.withCredentials,file:t,data:e.data,filename:C,action:e.action,onProgress:n=>{O(n,t)},onSuccess:n=>{U(n,t)},onError:(n,a)=>{j(n,a,t)}})},K=t=>{t.uid=p(),$[t.uid]=t;const n={status:"uploading",name:t.name,size:t.size,percentage:0,uid:t.uid,showProgress:!0};v("fileList",[...m.fileList,n])},F=t=>{const n=m.fileList;let a;return n.every(r=>(a=t.uid===r.uid?r:null,!a)),a},O=(t,n)=>{const a=F(n);e.onProgress&&e.onProgress(t,a,m.fileList),v("fileList",r=>r.uid===n.uid,"percentage",t.percent||0)},U=(t,n)=>{const a=F(n);a&&(v("fileList",r=>r.uid===n.uid,D(r=>{r.status="finished",r.response=t,r.url=e.getFileUrl&&e.getFileUrl(t,r)})),e.onSuccess&&e.onSuccess(t,a,m.fileList),setTimeout(()=>{v("fileList",r=>r.uid===n.uid,D(r=>{r.showProgress=!1}))},1e3))},j=(t,n,a)=>{F(a),v("fileList",r=>r.uid===a.uid,"status","fail"),e.onError&&e.onError(t,n,a)},z=t=>{v("fileList",D(n=>{n.splice(n.indexOf(t),1)})),delete $[t.uid],e.onRemove&&e.onRemove(t,m.fileList)},B=t=>{t.status==="finished"&&(v("previewUrl",t.url),c(!0),e.onPreview&&e.onPreview(t))},N=()=>{const t=ce(m.fileList);$={},v("fileList",[]),e.onClear&&e.onClear(t)},M=()=>{e.disabled||E.click()},V=t=>{const n=$[t.uid];n&&J({headers:e.headers,withCredentials:e.withCredentials,file:n,data:e.data,filename:C,action:e.action,onProgress:a=>{O(a,n)},onSuccess:a=>{U(a,n)},onError:(a,r)=>{j(a,r,n)}})},W=t=>{t.preventDefault&&t.preventDefault(),f(!1),!e.disabled&&x(t.dataTransfer.files)},Y=t=>{e.disabled||e.paste&&x(t.clipboardData.files)},Q=t=>{t.preventDefault&&t.preventDefault(),f(!0)},Z=t=>{t.preventDefault&&t.preventDefault(),f(!1)},ee=()=>m.fileList.map(t=>({...t}));let E;return e.ref&&e.ref({clearFiles:()=>{$={},v("fileList",[])},getFileList:ee}),(()=>{const t=Pe(),n=t.firstChild;n.addEventListener("change",g);const a=E;return typeof a=="function"?ue(a,n):E=n,o(t,u(L,{get when(){return e.listType==="picture"},get children(){return u(be,{get files(){return m.fileList},onRemove:z,onPreview:B,onClick:M,get children(){return e.children}})}}),null),o(t,u(L,{get when(){return e.listType!=="picture"},get children(){return[(()=>{const r=Ee();return r.addEventListener("dragleave",Z),r.addEventListener("dragover",Q),r.addEventListener("paste",Y),r.addEventListener("drop",W),r.$$click=M,o(r,()=>e.children),r})(),u(_e,{get files(){return m.fileList},onRemove:z,onPreview:B,onClear:N,onRetry:V})]}}),null),o(t,u(se,{get previewList(){return[m.previewUrl]},visible:[s,c]}),null),k(r=>{const te=S(),ne=e.style,T=e.multiple,A=e.webkitdirectory,q=e.accept;return r._v$=oe(t,te,r._v$),r._v$2=de(t,ne,r._v$2),T!==r._v$3&&(n.multiple=r._v$3=T),A!==r._v$4&&y(n,"webkitdirectory",r._v$4=A),q!==r._v$5&&y(n,"accept",r._v$5=q),r},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t})()}R(["click"]);export{xe as U};
