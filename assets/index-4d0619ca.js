import{n as q,i as d,a as t,T as _,f as $,I as L,g as A,A as D,F as te,t as v,N as me,c as T,r as ge,b as he,a6 as ve,Y,R as O,u as ne,h as ye,s as Le,j as _e,S as h}from"./index-39ed6b74.js";import{B as x,C as w}from"./index-f8aef721.js";import{P as Fe}from"./index-1a501803.js";import{T as B}from"./Title-9180e6b0.js";import{D as b,a as E,C as $e}from"./code-a8f5f1bb.js";import{P as C}from"./Paragraph-97fd5b1c.js";import{T as Q,p as we,e as be}from"./columns-f7fa8682.js";import{h as Ee}from"./hljs-74a5c6d1.js";import"./_commonjsHelpers-725317a4.js";function Ce(e,c,f){const s=`fail to post ${e} ${f.status}'`,i=new Error(s);return i.status=f.status,i.method="post",i.url=e,i}function Z(e){const c=e.responseText||e.response;if(!c)return c;try{return JSON.parse(c)}catch{return c}}function ee(e){if(typeof XMLHttpRequest>"u")return;const c=new XMLHttpRequest,f=e.action;c.upload&&(c.upload.onprogress=function(o){o.total>0&&(o.percent=o.loaded/o.total*100),e.onProgress(o)});const s=new FormData;e.data&&Object.keys(e.data).map(a=>{s.append(a,e.data[a])}),s.append(e.filename,e.file),c.onerror=function(o){e.onError(o)},c.onload=function(){if(c.status<200||c.status>=300)return e.onError(Ce(f,e,c),Z(c));e.onSuccess(Z(c))},c.open("post",f,!0),e.withCredentials&&"withCredentials"in c&&(c.withCredentials=!0);const i=e.headers||{};for(let a in i)i.hasOwnProperty(a)&&i[a]!==null&&c.setRequestHeader(a,i[a]);c.send(s)}const Pe=v('<div class="cm-upload-list-title">'),Se=v('<ul class="cm-upload-list">'),xe=v('<img class="cm-upload-file-preview-img" alt="">'),De=v('<div class="cm-upload-error">'),ke=v('<li class="cm-upload-file-card"><div class="cm-upload-file-preview"></div><div class="cm-upload-file-card-body"><div class="cm-upload-file-card-info"><span class="cm-upload-file-card-info-name"></span><span></span></div></div><div class="cm-upload-file-control">');function Ue(e){const c=s=>{const i=s.name.split(".").pop().toLocaleLowerCase()||"";let a="file-text";return["gif","jpg","jpeg","png","bmp","webp"].indexOf(i)>-1&&(a="image"),["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(i)>-1&&(a="film1"),["mp3","wav","wma","ogg","aac","flac"].indexOf(i)>-1&&(a="music"),a},f=s=>{if(s<1024)return s+"B";if(s<1048576)return Math.round(s/1024*10)/10+"KB";if(s<1073741824)return Math.round(s/1024/1024*10)/10+"MB";if(s<1099511627776)return Math.round(s/1024/1024/1024*10)/10+"GB"};return(()=>{const s=Se();return d(s,t($,{get when(){return e.files&&e.files.length},get children(){const i=Pe();return d(i,t(_,{type:"secondary",children:"已上传文件"}),null),d(i,t(_,{type:"primary",class:"cm-upload-clear",get onClick(){return e.onClear},children:"清空"}),null),i}}),null),d(s,t(te,{get each(){return e.files},children:i=>(()=>{const a=ke(),o=a.firstChild,p=o.nextSibling,g=p.firstChild,m=g.firstChild,F=m.nextSibling,k=p.nextSibling;return d(o,t($,{get when(){return i.url},get fallback(){return t(L,{get name(){return c(i)},size:20})},get children(){const y=xe();return y.$$click=()=>{e.onPreview&&e.onPreview(i)},A(()=>D(y,"src",i.url)),y}})),d(m,()=>i.name),d(F,()=>f(i.size)),d(p,t($,{get when(){return i.showProgress&&i.percentage!==100},get children(){return t(Fe,{strokeWidth:4,get value(){return i.percentage},hidePercent:!0})}}),null),d(p,t($,{get when(){return i.status==="fail"},get children(){const y=De();return d(y,t(L,{name:"alert-circle",size:12}),null),d(y,t(_,{type:"error",size:"small",class:"cm-upload-error-text",children:"上传失败"}),null),d(y,t(_,{type:"primary",class:"cm-upload-retry",size:"small",onClick:()=>{e.onRetry&&e.onRetry(i)},children:"重试"}),null),y}}),null),d(k,t(x,{size:"small",ghost:!0,get icon(){return t(L,{name:"x"})},onClick:()=>{e.onRemove&&e.onRemove(i)}})),A(()=>D(m,"title",i.name)),a})()}),null),s})()}q(["click"]);const ze=v('<ul class="cm-upload-list cm-upload-picture-list"><li class="cm-upload-picture-add">'),Be=v('<li class="cm-upload-picture-card"><img class="cm-upload-picture-img" alt=""><div class="cm-upload-picture-remove"></div><div class="cm-upload-picture-preview">');function Ae(e){return(()=>{const c=ze(),f=c.firstChild;return d(c,t(te,{get each(){return e.files},children:s=>(()=>{const i=Be(),a=i.firstChild,o=a.nextSibling,p=o.nextSibling;return o.$$click=()=>{e.onRemove&&e.onRemove(s)},d(o,t(L,{name:"x-circle"})),p.$$click=()=>{e.onPreview&&e.onPreview(s)},d(p,t(L,{name:"eye",size:20})),A(()=>D(a,"src",s.url)),i})()}),f),me(f,"click",e.onClick,!0),d(f,()=>e.children),c})()}q(["click"]);const je=v('<div class="cm-upload-out">'),Re=v('<div><input class="cm-upload-input" type="file">');function P(e){const[c,f]=T(!1),[s,i]=T(!1),a=e.format??[],o=[],p=e.type??"select",[g,m]=ge({fileList:o,previewUrl:""});let F={};const k=e.name??"file",y=()=>_e(e,"cm-upload",{"cm-upload-select":p==="select","cm-upload-drag":p==="drag","cm-upload-dragOver":p==="drag"&&c()});he(()=>{if(e.defaultFileList){const n=e.defaultFileList.map(r=>(r.uid||(r.uid=Y()),r));m("fileList",n)}});const re=n=>{const r=n.target.files;r&&(j(r),z.value=null)},j=n=>{let r=Array.prototype.slice.call(n);e.multiple||(r=r.slice(0,1)),r.length!==0&&r.forEach(u=>{ae(u)})},ae=n=>{if(!e.beforeUpload)return U(n);const r=e.beforeUpload(n);r&&r.then?r.then(u=>{Object.prototype.toString.call(u)==="[object File]"?U(u):U(n)},()=>{}):r!==!1&&U(n)},U=n=>{if(a.length){const r=n.name.split(".").pop().toLocaleLowerCase();if(!a.some(l=>l.toLocaleLowerCase()===r))return e.onFormatError&&e.onFormatError(n,o),!1}if(e.maxSize&&n.size>e.maxSize*1024)return e.onExceededSize&&e.onExceededSize(n,o),!1;ie(n),ee({headers:e.headers,withCredentials:e.withCredentials,file:n,data:e.data,filename:k,action:e.action,onProgress:r=>{I(r,n)},onSuccess:r=>{M(r,n)},onError:(r,u)=>{H(r,u,n)}})},ie=n=>{n.uid=Y(),F[n.uid]=n;const r={status:"uploading",name:n.name,size:n.size,percentage:0,uid:n.uid,showProgress:!0};m("fileList",[...g.fileList,r])},R=n=>{const r=g.fileList;let u;return r.every(l=>(u=n.uid===l.uid?l:null,!u)),u},I=(n,r)=>{const u=R(r);e.onProgress&&e.onProgress(n,u,g.fileList),m("fileList",l=>l.uid===r.uid,"percentage",n.percent||0)},M=(n,r)=>{const u=R(r);u&&(m("fileList",l=>l.uid===r.uid,O(l=>{l.status="finished",l.response=n,l.url=n.url})),e.onSuccess&&e.onSuccess(n,u,g.fileList),setTimeout(()=>{m("fileList",l=>l.uid===r.uid,O(l=>{l.showProgress=!1}))},1e3))},H=(n,r,u)=>{R(u),m("fileList",l=>l.uid===u.uid,"status","fail"),e.onError&&e.onError(n,r,u)},N=n=>{m("fileList",O(r=>{r.splice(r.indexOf(n),1)})),delete F[n.uid],e.onRemove&&e.onRemove(n,g.fileList)},X=n=>{n.status==="finished"&&(m("previewUrl",n.url),i(!0),e.onPreview&&e.onPreview(n))},G=()=>{F={},m("fileList",[])},J=()=>{e.disabled||z.click()},le=n=>{const r=F[n.uid];r&&ee({headers:e.headers,withCredentials:e.withCredentials,file:r,data:e.data,filename:k,action:e.action,onProgress:u=>{I(u,r)},onSuccess:u=>{M(u,r)},onError:(u,l)=>{H(u,l,r)}})},se=n=>{n.preventDefault&&n.preventDefault(),f(!1),!e.disabled&&j(n.dataTransfer.files)},oe=n=>{e.disabled||e.paste&&j(n.clipboardData.files)},ce=n=>{n.preventDefault&&n.preventDefault(),f(!0)},ue=n=>{n.preventDefault&&n.preventDefault(),f(!1)},de=()=>g.fileList.map(n=>({...n}));let z;return e.ref&&e.ref({clearFiles:G,getFileList:de}),(()=>{const n=Re(),r=n.firstChild;r.addEventListener("change",re);const u=z;return typeof u=="function"?ne(u,r):z=r,d(n,t($,{get when(){return e.listType==="picture"},get children(){return t(Ae,{get files(){return g.fileList},onRemove:N,onPreview:X,onClick:J,get children(){return e.children}})}}),null),d(n,t($,{get when(){return e.listType!=="picture"},get children(){return[(()=>{const l=je();return l.addEventListener("dragleave",ue),l.addEventListener("dragover",ce),l.addEventListener("paste",oe),l.addEventListener("drop",se),l.$$click=J,d(l,()=>e.children),l})(),t(Ue,{get files(){return g.fileList},onRemove:N,onPreview:X,onClear:G,onRetry:le})]}}),null),d(n,t(ve,{get previewList(){return[g.previewUrl]},visible:[s,i]}),null),A(l=>{const fe=y(),pe=e.style,K=e.multiple,V=e.webkitdirectory,W=e.accept;return l._v$=ye(n,fe,l._v$),l._v$2=Le(n,pe,l._v$2),K!==l._v$3&&(r.multiple=l._v$3=K),V!==l._v$4&&D(r,"webkitdirectory",l._v$4=V),W!==l._v$5&&D(r,"accept",l._v$5=W),l},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),n})()}q(["click"]);const Oe=`<Upload action="/test/file/upload/test" name="file" 
    onProgress={(e: any, file: any, fileList: any[]) => {
        console.log(file);
    }} onSuccess={() => {
        console.log('success');
    }} onError={(e: any) => {
        console.log(e);
    }}>
    <Button icon={<Icon name='upload'/>} type='primary'>Upload Files</Button>
</Upload>`,Te=`<Upload action="/test/file/upload/test" name="file" accept="jpg" 
    defaultFileList={[
        {
            name: 'test.png',
            status: 'finished',
            size: 71183,
            preview: true,
            url: '/test/file/view/test/temp1.png',
        }
    ]}
    onProgress={(e: any, file: any, fileList: any[]) => {
        console.log(file);
    }} onSuccess={() => {
        console.log('success');
    }} onError={(e: any) => {
        console.log(e);
    }}>
    <Button icon={<Icon name='upload'/>} type='primary'>Upload Files</Button>
</Upload>`,qe=`<Space dir="v">
    <Upload action="/test/file/upload/test" name="file" type="drag" data={data()} headers={headers} accept="jpg">
        <div class="cm-upload-drag-wrap">
            <Icon name='upload' size={32}/>
            <p>Click or drag files here to upload</p>
        </div>
    </Upload>
</Space>`,Ie=`<Space dir="v">
    <Upload action="/test/file/upload/test" listType="picture" name="file" data={data()} headers={headers} accept=".jpg,.jpeg" ref={upload}
        defaultFileList={[
            {
                name: 'test.png',
                status: 'finished',
                size: 71183,
                preview: true,
                url: '/test/file/view/test/temp1.png',
            }
        ]}>
            <Icon name='plus1' size={20}/>
    </Upload>
</Space>`,Me=`<Upload action="/test/file/upload/test" name="file" data={data()} headers={headers} accept="jpg" ref={upload}
    defaultFileList={[
        {
            name: 'test.png',
            status: 'finished',
            size: 71183,
            preview: true,
            url: '/test/file/view/test/temp1.png',
        }
    ]}
    onProgress={(e: any, file: any, fileList: any[]) => {
        console.log(file);
    }} onSuccess={() => {
        console.log('success');
    }} onError={(e: any) => {
        console.log(e);
    }}>
        <Button icon={<Icon name='upload'/>} type='primary'>Upload Files</Button>
</Upload>

<Button type='primary' onClick={() => {
console.log(upload.getFileList());
}}>获取文件列表</Button>`,He=[{name:"classList",desc:"自定义class",type:"Object",default:""},{name:"class",desc:"自定义class",type:"string",default:""},{name:"style",desc:"自定义样式",type:"Object",default:""},{name:"action",desc:"上传的地址",type:"string",default:""},{name:"name",desc:"name属性",type:"string",default:""},{name:"multiple",desc:"是否支持多选文件",type:"boolean",default:""},{name:"webkitdirectory",desc:"是否开启选择文件夹，部分浏览器适用",type:"boolean",default:""},{name:"accept",desc:"接受上传的文件类型",type:"string",default:""},{name:"beforeUpload",desc:"上传文件之前的钩子，参数为上传的文件，若返回 false 或者 Promise 则停止上传",type:"Function",default:""},{name:"format",desc:"支持的文件类型，与 accept 不同的是，format 是识别文件的后缀名",type:"string[]",default:""},{name:"maxSize",desc:"文件大小限制，单位b",type:"Number",default:""},{name:"headers",desc:"设置上传的请求头部",type:"Object",default:""},{name:"withCredentials",desc:"支持发送 cookie 凭证信息",type:"boolean",default:""},{name:"data",desc:"上传时附带的额外参数",type:"Object",default:""},{name:"defaultFileList",desc:"默认已上传的文件列表",type:"Array",default:""},{name:"type",desc:"上传控件的类型， select|drag",type:"string",default:"select"},{name:"paste",desc:"是否支持粘贴上传文件",type:"boolean",default:""},{name:"ref",desc:"组件引用",type:"any",default:""},{name:"listType",desc:"列表的类型 picture",type:"boolean",default:""},{name:"onProgress",desc:"文件上传时的钩子，返回字段为 event, file, fileList",type:"Function",default:""},{name:"onSuccess",desc:"文件上传成功时的钩子，返回字段为 response, file, fileList",type:"Function",default:""},{name:"onError",desc:"文件上传失败时的钩子，返回字段为 error, file, fileList",type:"Function",default:""},{name:"onRemove",desc:"文件列表移除文件时的钩子，返回字段为 file, fileList",type:"Function",default:""},{name:"onPreview",desc:"点击已上传的文件链接时的钩子，返回字段为 file， 可以通过 file.response 拿到服务端返回数据",type:"Function",default:""},{name:"onFormatError",desc:"文件格式验证失败时的钩子，返回字段为 file, fileList",type:"Function",default:""},{name:"onExceededSize",desc:"文件超出指定大小限制时的钩子，返回字段为 file, fileList",type:"Function",default:""}],Ne=[{name:"onProgress",desc:"文件上传时的钩子",params:"event, file, fileList"},{name:"onSuccess",desc:"文件上传成功时的钩子",params:"response, file, fileList"},{name:"onError",desc:"文件上传失败时的钩子",params:"error, file, fileList"},{name:"onRemove",desc:"文件列表移除文件时的钩子",params:"file, fileList"},{name:"onPreview",desc:"点击已上传的文件链接时的钩子",params:"file"},{name:"onFormatError",desc:"文件格式验证失败时的钩子",params:"file, fileList"},{name:"onExceededSize",desc:"文件超出指定大小限制时的钩子",params:"file, fileList"}],Xe=[{id:"upload_base",text:"基础用法"},{id:"upload_defaultList",text:"默认列表"},{id:"upload_drag",text:"拖拽"},{id:"upload_pictures",text:"照片墙"},{id:"upload_getList",text:"获取列表"},{id:"comp_api",text:"API"},{id:"comp_props",text:"属性"},{id:"comp_events",text:"事件"}],S={upload_base:Oe,upload_defaultList:Te,upload_drag:qe,upload_pictures:Ie,upload_getList:Me},Ge=v('<div class="cm-upload-drag-wrap"><p>Click or drag files here to upload'),Je=v('<div class="sys-ctx-main-left">');function rt(){const[e,c]=T({field:"1"}),f={"x-token":"123456"};let s;return[(()=>{const i=Je();return ne(Ee,i,()=>""),d(i,t(h,{dir:"v",size:32,get children(){return[t(B,{heading:2,children:"Upload 上传"}),t(h,{id:"upload_base",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",onProgress:(a,o,p)=>{console.log(o)},onSuccess:()=>{console.log("success")},onError:a=>{console.log(a)},get children(){return t(x,{get icon(){return t(L,{name:"upload"})},type:"primary",children:"Upload Files"})}}),t(b,{align:"left",get children(){return t(_,{type:"primary",children:"基础用法"})}}),t(C,{type:"secondary",spacing:"extended",children:"基础用法"}),t(E,{get data(){return S.upload_base}})]}})}}),t(h,{id:"upload_defaultList",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",accept:"jpg",defaultFileList:[{name:"test.png",status:"finished",size:71183,preview:!0,url:"https://cqb325.gitee.io/cui-solid-doc/logo.svg"}],onProgress:(a,o,p)=>{console.log(o)},onSuccess:()=>{console.log("success")},onError:a=>{console.log(a)},get children(){return t(x,{get icon(){return t(L,{name:"upload"})},type:"primary",children:"Upload Files"})}}),t(b,{align:"left",get children(){return t(_,{type:"primary",children:"默认列表"})}}),t(C,{type:"secondary",spacing:"extended",children:"defaultFileList 可以初始化默认的列表"}),t(E,{get data(){return S.upload_defaultList}})]}})}}),t(h,{id:"upload_drag",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(h,{dir:"v",get children(){return t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",type:"drag",get data(){return e()},headers:f,accept:"jpg",get children(){const a=Ge(),o=a.firstChild;return d(a,t(L,{name:"upload",size:32}),o),a}})}}),t(b,{align:"left",get children(){return t(_,{type:"primary",children:"拖拽"})}}),t(C,{type:"secondary",spacing:"extended",children:'type="drag" 可以支持拖拽上传， 上传的数据使用data传入， 自定义请求头通过 headers 参数传输'}),t(E,{get data(){return S.upload_drag}})]}})}}),t(h,{id:"upload_pictures",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(h,{dir:"v",get children(){return t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",listType:"picture",name:"file",get data(){return e()},headers:f,accept:".jpg,.jpeg",ref(a){const o=s;typeof o=="function"?o(a):s=a},defaultFileList:[{name:"test.png",status:"finished",size:71183,preview:!0,url:"https://cqb325.gitee.io/cui-solid-doc/logo.svg"}],get children(){return t(L,{name:"plus1",size:20})}})}}),t(b,{align:"left",get children(){return t(_,{type:"primary",children:"照片墙"})}}),t(C,{type:"secondary",spacing:"extended",children:'listType="picture" 文件列表以照片墙的形式展示'}),t(E,{get data(){return S.upload_pictures}})]}})}}),t(h,{id:"upload_getList",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",get data(){return e()},headers:f,accept:"jpg",ref(a){const o=s;typeof o=="function"?o(a):s=a},defaultFileList:[{name:"test.png",status:"finished",size:71183,preview:!0,url:"https://cqb325.gitee.io/cui-solid-doc/logo.svg"}],onProgress:(a,o,p)=>{console.log(o)},onSuccess:()=>{console.log("success")},onError:a=>{console.log(a)},get children(){return t(x,{get icon(){return t(L,{name:"upload"})},type:"primary",children:"Upload Files"})}}),t(x,{type:"primary",onClick:()=>{console.log(s.getFileList())},children:"获取文件列表"}),t(b,{align:"left",get children(){return t(_,{type:"primary",children:"获取列表"})}}),t(C,{type:"secondary",spacing:"extended",children:"通过ref获取upload的引用， 可调用 getFileList 获取文件列表"}),t(E,{get data(){return S.upload_getList}})]}})}}),t(h,{dir:"v",size:24,id:"comp_api",get children(){return[t(B,{type:"primary",heading:3,children:"API"}),t(h,{id:"comp_props",dir:"v",get children(){return[t(B,{type:"primary",heading:4,children:"TimePicker Props"}),t(Q,{columns:we,data:He,border:!0,size:"small"})]}}),t(h,{id:"comp_events",dir:"v",get children(){return[t(B,{type:"primary",heading:4,children:"Events"}),t(Q,{columns:be,data:Ne,border:!0,size:"small"})]}})]}})]}})),i})(),t($e,{data:Xe})]}export{rt as default};
