import{c as L,e as N,f as H,E as U,d as w,i as M,a as d,g as W,h as I,I as X,D as Z,t as O,Q as S,Y as D,u as p,j as ee,s as te,k as le}from"./index-5e0fdc25.js";import{E as ne,O as ae}from"./EmptyOption-a0a97b87.js";import{V as ie}from"./Value-53f54136.js";import{c as ce}from"./createField-47c85f73.js";import{_ as se}from"./code-f8e23b11.js";const ue=O("<div>"),re=O('<ul class="cm-select-option-list">'),de=O('<div class="cm-select-options-wrap"><div class="cm-select-options">'),fe=O('<div class="cm-select-loading">加载中');function _e(e){let E;const c=e.textField||"label",s=e.valueField||"value",[$,v]=L(!1),T=e.align??"bottomLeft",P=N(()=>e.children),A=()=>P.toArray(),[u,f]=ce(e,e.multi?[]:"");let h=[];e.filter&&e.defaultLabel&&(e.multi&&e.defaultLabel instanceof Array?e.defaultLabel.forEach((t,l)=>{h.push({[s]:u()[l],[c]:t})}):h=[{[s]:u(),[c]:e.defaultLabel}]);let o=!0;const[k,m]=L(e.filter&&e.multi?"":e.defaultLabel);queueMicrotask(()=>{o=!1});const[g,b]=L(h);let F=null;const Q=()=>le(e,"cm-select",{"cm-select-disabled":e.disabled,[`cm-select-${e.size}`]:e.size,"cm-select-clearable":!e.disabled&&e.clearable&&`${u()}`.length!==0,"cm-select-multi":e.multi,"cm-select-open":$(),"cm-select-with-prefix":e.prefix});let _={};function q(t,l){t&&t.forEach(n=>{l.push(n),n._show=!0,_[n[s]]=n,n.items&&q(n.items,l)})}const j=H(()=>{const t=A();_={};let l=[];return e.emptyOption&&l.push({[s]:"",[c]:e.emptyOption,_show:!0,emptyOption:!0}),h&&h.forEach(n=>{l.push({...n,_show:!0})}),t&&q(t,l),l}),[R,C]=U({list:[]});w(()=>{const t=S(()=>u());C("list",j()),C("list",l=>l,D(l=>{e.multi?l._checked=t.includes(l[s]):l._checked=t===l[s]}))}),w(()=>{const t=u();C("list",l=>l,D(l=>{e.multi?l._checked=t.includes(l[s]):l._checked=t===l[s]}))});const Y=(t,l)=>{if(_[t]&&_[t].items&&_[t].items.length)return;let n=g();if(e.multi){let a=u();const i=a.indexOf(t);i>-1?(a.splice(i,1),n.splice(i,1)):(a=[...a],a.push(t),n.push(l)),f([...a]),m(""),b([...n]),e.onChange&&e.onChange(a,l)}else o=!0,n=[l],f(t),m(l[c]),b([...n]),Promise.resolve().then(()=>{o=!1}),v(!1),e.onChange&&e.onChange(t,l)},B=()=>{const t=[];return g().map(n=>{t.push({id:n[s],title:n[c]})}),e.multi?t.length?t:e.emptyOption?[{id:"",title:e.emptyOption}]:[]:t.length?t[0].title:e.emptyOption?e.emptyOption:""},V=t=>{b([]),e.multi?(e.onChange&&e.onChange([]),f([])):(e.onChange&&e.onChange(""),f(""),m(""),v(!1))};w(()=>{const t=k();o||(e.remoteMethod?t&&(h=[],clearTimeout(F),F=setTimeout(()=>{e.remoteMethod?.(t),v(!0)},e.debounceTime||300)):C("list",l=>l,D(l=>{l._show=l[c].indexOf(t)>-1})))}),w(()=>{if(!$()&&e.filter)if(e.multi)m("");else{const t=S(()=>g()),l=S(()=>k());t.length&&t[0][c]!==l&&(o=!0,m(t[0][c]),queueMicrotask(()=>{o=!1}))}});const G=(t,l)=>{if(e.multi){let n=g(),a=u();const i=a.indexOf(t.id);i>-1&&(a.splice(i,1),n.splice(i,1)),f([...a]),b([...n]),e.onChange&&e.onChange(a)}},J=()=>{if(e.multi){let t=g(),l=u();l.length>0&&(l.pop(),t.pop(),f([...l]),b([...t]),e.onChange&&e.onChange(l))}},K=H(()=>R.list.filter(t=>t._show));return(()=>{const t=ue(),l=E;return typeof l=="function"?p(l,t):E=t,M(t,d(Z,{get transfer(){return e.transfer},align:T,get disabled(){return e.disabled},trigger:"click",visible:[$,v],get menu(){return(()=>{const n=de(),a=n.firstChild;return M(a,d(W,{get when(){return!e.loading},get fallback(){return fe()},get children(){const i=re();return M(i,d(se,{get items(){return K()},itemEstimatedSize:30,maxHeight:200,children:y=>{const r=y.item;return r.emptyOption?d(ne,{visible:!0,get data(){return{label:r[c],value:""}},get checked(){return u()===""},onClick:V}):d(ae,{ref(x){const z=y.ref;typeof z=="function"?z(x):y.ref=x},get renderOption(){return y.renderOption},get visible(){return r._show},get disabled(){return r.disabled},data:r,get checked(){return r._checked},textField:c,valueField:s,onClick:x=>Y(x,r)})}})),i}})),I(()=>(e.maxHeight?`${e.maxHeight}px`:"")!=null?a.style.setProperty("max-height",e.maxHeight?`${e.maxHeight}px`:""):a.style.removeProperty("max-height")),n})()},get children(){return d(ie,{get text(){return B()},get multi(){return e.multi},get showMax(){return e.showMax},get disabled(){return e.disabled},get showMore(){return e.showMore},get valueClosable(){return e.valueClosable||e.filter},get clearable(){return e.clearable},onClear:V,get placeholder(){return e.placeholder},get prepend(){return e.prefix},get size(){return e.size},get icon(){return d(X,{name:"chevron-down",class:"cm-select-cert"})},onClose:G,query:[k,m],get filter(){return e.filter},onDeleteLastValue:J})}})),I(n=>{const a=Q(),i=e.style;return n._v$=ee(t,a,n._v$),n._v$2=te(t,i,n._v$2),n},{_v$:void 0,_v$2:void 0}),t})()}export{_e as S};
