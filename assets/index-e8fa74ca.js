import{n as I,i as d,a as t,T as F,f as $,I as L,g as A,A as D,F as ne,t as v,N as me,c as q,r as ge,b as he,a6 as ve,Y as Q,R as T,u as re,h as ye,s as Le,j as Fe,S as h}from"./index-452b01fb.js";import{B as x,C as w}from"./index-0b64bc6d.js";import{P as _e}from"./index-eb7d4b4f.js";import{T as B}from"./Title-92e03596.js";import{D as E,a as b,C as $e}from"./code-6c1bd720.js";import{P as C}from"./Paragraph-cb384130.js";import{T as Z,p as we,e as Ee}from"./columns-64ff655e.js";import{h as be}from"./hljs-74a5c6d1.js";import"./_commonjsHelpers-725317a4.js";function Ce(e,o,f){const l=`fail to post ${e} ${f.status}'`,u=new Error(l);return u.status=f.status,u.method="post",u.url=e,u}function ee(e){const o=e.responseText||e.response;if(!o)return o;try{return JSON.parse(o)}catch{return o}}function te(e){if(typeof XMLHttpRequest>"u")return;const o=new XMLHttpRequest,f=e.action;o.upload&&(o.upload.onprogress=function(s){s.total>0&&(s.percent=s.loaded/s.total*100),e.onProgress(s)});const l=new FormData;e.data&&Object.keys(e.data).map(r=>{l.append(r,e.data[r])}),l.append(e.filename,e.file),o.onerror=function(s){e.onError(s)},o.onload=function(){if(o.status<200||o.status>=300)return e.onError(Ce(f,e,o),ee(o));e.onSuccess(ee(o))},o.open("post",f,!0),e.withCredentials&&"withCredentials"in o&&(o.withCredentials=!0);const u=e.headers||{};for(let r in u)u.hasOwnProperty(r)&&u[r]!==null&&o.setRequestHeader(r,u[r]);o.send(l)}const Pe=v('<div class="cm-upload-list-title">'),Se=v('<ul class="cm-upload-list"><div class="cm-upload-files">'),xe=v('<img class="cm-upload-file-preview-img" alt="">'),De=v('<div class="cm-upload-error">'),ke=v('<li class="cm-upload-file-card"><div class="cm-upload-file-preview"></div><div class="cm-upload-file-card-body"><div class="cm-upload-file-card-info"><span class="cm-upload-file-card-info-name"></span><span></span></div></div><div class="cm-upload-file-control">');function Ue(e){const o=l=>{const u=l.name.split(".").pop().toLocaleLowerCase()||"";let r="file-text";return["gif","jpg","jpeg","png","bmp","webp"].indexOf(u)>-1&&(r="image"),["mp4","m3u8","rmvb","avi","swf","3gp","mkv","flv"].indexOf(u)>-1&&(r="film1"),["mp3","wav","wma","ogg","aac","flac"].indexOf(u)>-1&&(r="music"),r},f=l=>{if(l<1024)return l+"B";if(l<1048576)return Math.round(l/1024*10)/10+"KB";if(l<1073741824)return Math.round(l/1024/1024*10)/10+"MB";if(l<1099511627776)return Math.round(l/1024/1024/1024*10)/10+"GB"};return(()=>{const l=Se(),u=l.firstChild;return d(l,t($,{get when(){return e.files&&e.files.length},get children(){const r=Pe();return d(r,t(F,{type:"secondary",children:"已上传文件"}),null),d(r,t(F,{type:"primary",class:"cm-upload-clear",get onClick(){return e.onClear},children:"清空"}),null),r}}),u),d(u,t(ne,{get each(){return e.files},children:r=>(()=>{const s=ke(),m=s.firstChild,p=m.nextSibling,g=p.firstChild,_=g.firstChild,k=_.nextSibling,R=p.nextSibling;return d(m,t($,{get when(){return r.url},get fallback(){return t(L,{get name(){return o(r)},size:20})},get children(){const y=xe();return y.$$click=()=>{e.onPreview&&e.onPreview(r)},A(()=>D(y,"src",r.url)),y}})),d(_,()=>r.name),d(k,()=>f(r.size)),d(p,t($,{get when(){return r.showProgress&&r.percentage!==100},get children(){return t(_e,{strokeWidth:4,get value(){return r.percentage},hidePercent:!0})}}),null),d(p,t($,{get when(){return r.status==="fail"},get children(){const y=De();return d(y,t(L,{name:"alert-circle",size:12}),null),d(y,t(F,{type:"error",size:"small",class:"cm-upload-error-text",children:"上传失败"}),null),d(y,t(F,{type:"primary",class:"cm-upload-retry",size:"small",onClick:()=>{e.onRetry&&e.onRetry(r)},children:"重试"}),null),y}}),null),d(R,t(x,{size:"small",ghost:!0,get icon(){return t(L,{name:"x"})},onClick:()=>{e.onRemove&&e.onRemove(r)}})),A(()=>D(_,"title",r.name)),s})()})),l})()}I(["click"]);const ze=v('<ul class="cm-upload-list cm-upload-picture-list"><li class="cm-upload-picture-add">'),Be=v('<li class="cm-upload-picture-card"><img class="cm-upload-picture-img" alt=""><div class="cm-upload-picture-remove"></div><div class="cm-upload-picture-preview">');function Ae(e){return(()=>{const o=ze(),f=o.firstChild;return d(o,t(ne,{get each(){return e.files},children:l=>(()=>{const u=Be(),r=u.firstChild,s=r.nextSibling,m=s.nextSibling;return s.$$click=()=>{e.onRemove&&e.onRemove(l)},d(s,t(L,{name:"x-circle"})),m.$$click=()=>{e.onPreview&&e.onPreview(l)},d(m,t(L,{name:"eye",size:20})),A(()=>D(r,"src",l.url)),u})()}),f),me(f,"click",e.onClick,!0),d(f,()=>e.children),o})()}I(["click"]);const Re=v('<div class="cm-upload-out">'),je=v('<div><input class="cm-upload-input" type="file">');function P(e){const[o,f]=q(!1),[l,u]=q(!1),r=e.format??[],s=[],m=e.type??"select",[p,g]=ge({fileList:s,previewUrl:""});let _={};const k=e.name??"file",R=()=>Fe(e,"cm-upload",{"cm-upload-select":m==="select","cm-upload-drag":m==="drag","cm-upload-dragOver":m==="drag"&&o()});he(()=>{if(e.defaultFileList){const n=e.defaultFileList.map(a=>(a.uid||(a.uid=Q()),a));g("fileList",n)}});const y=n=>{const a=n.target.files;a&&(j(a),z.value=null)},j=n=>{let a=Array.prototype.slice.call(n);e.multiple||(a=a.slice(0,1)),a.length!==0&&a.forEach(c=>{ae(c)})},ae=n=>{if(!e.beforeUpload)return U(n);const a=e.beforeUpload(n);a&&a.then?a.then(c=>{Object.prototype.toString.call(c)==="[object File]"?U(c):U(n)},()=>{}):a!==!1&&U(n)},U=n=>{if(r.length){const a=n.name.split(".").pop().toLocaleLowerCase();if(!r.some(i=>i.toLocaleLowerCase()===a))return e.onFormatError&&e.onFormatError(n,s),!1}if(e.maxSize&&n.size>e.maxSize*1024)return e.onExceededSize&&e.onExceededSize(n,s),!1;ie(n),te({headers:e.headers,withCredentials:e.withCredentials,file:n,data:e.data,filename:k,action:e.action,onProgress:a=>{M(a,n)},onSuccess:a=>{H(a,n)},onError:(a,c)=>{N(a,c,n)}})},ie=n=>{n.uid=Q(),_[n.uid]=n;const a={status:"uploading",name:n.name,size:n.size,percentage:0,uid:n.uid,showProgress:!0};g("fileList",[...p.fileList,a])},O=n=>{const a=p.fileList;let c;return a.every(i=>(c=n.uid===i.uid?i:null,!c)),c},M=(n,a)=>{const c=O(a);e.onProgress&&e.onProgress(n,c,p.fileList),g("fileList",i=>i.uid===a.uid,"percentage",n.percent||0)},H=(n,a)=>{const c=O(a);c&&(g("fileList",i=>i.uid===a.uid,T(i=>{i.status="finished",i.response=n,i.url=e.getFileUrl&&e.getFileUrl(n,i)})),e.onSuccess&&e.onSuccess(n,c,p.fileList),setTimeout(()=>{g("fileList",i=>i.uid===a.uid,T(i=>{i.showProgress=!1}))},1e3))},N=(n,a,c)=>{O(c),g("fileList",i=>i.uid===c.uid,"status","fail"),e.onError&&e.onError(n,a,c)},X=n=>{g("fileList",T(a=>{a.splice(a.indexOf(n),1)})),delete _[n.uid],e.onRemove&&e.onRemove(n,p.fileList)},G=n=>{n.status==="finished"&&(g("previewUrl",n.url),u(!0),e.onPreview&&e.onPreview(n))},J=()=>{p.fileList.forEach(n=>{e.onRemove&&e.onRemove(n,p.fileList)}),_={},g("fileList",[])},K=()=>{e.disabled||z.click()},le=n=>{const a=_[n.uid];a&&te({headers:e.headers,withCredentials:e.withCredentials,file:a,data:e.data,filename:k,action:e.action,onProgress:c=>{M(c,a)},onSuccess:c=>{H(c,a)},onError:(c,i)=>{N(c,i,a)}})},se=n=>{n.preventDefault&&n.preventDefault(),f(!1),!e.disabled&&j(n.dataTransfer.files)},oe=n=>{e.disabled||e.paste&&j(n.clipboardData.files)},ce=n=>{n.preventDefault&&n.preventDefault(),f(!0)},ue=n=>{n.preventDefault&&n.preventDefault(),f(!1)},de=()=>p.fileList.map(n=>({...n}));let z;return e.ref&&e.ref({clearFiles:J,getFileList:de}),(()=>{const n=je(),a=n.firstChild;a.addEventListener("change",y);const c=z;return typeof c=="function"?re(c,a):z=a,d(n,t($,{get when(){return e.listType==="picture"},get children(){return t(Ae,{get files(){return p.fileList},onRemove:X,onPreview:G,onClick:K,get children(){return e.children}})}}),null),d(n,t($,{get when(){return e.listType!=="picture"},get children(){return[(()=>{const i=Re();return i.addEventListener("dragleave",ue),i.addEventListener("dragover",ce),i.addEventListener("paste",oe),i.addEventListener("drop",se),i.$$click=K,d(i,()=>e.children),i})(),t(Ue,{get files(){return p.fileList},onRemove:X,onPreview:G,onClear:J,onRetry:le})]}}),null),d(n,t(ve,{get previewList(){return[p.previewUrl]},visible:[l,u]}),null),A(i=>{const fe=R(),pe=e.style,V=e.multiple,W=e.webkitdirectory,Y=e.accept;return i._v$=ye(n,fe,i._v$),i._v$2=Le(n,pe,i._v$2),V!==i._v$3&&(a.multiple=i._v$3=V),W!==i._v$4&&D(a,"webkitdirectory",i._v$4=W),Y!==i._v$5&&D(a,"accept",i._v$5=Y),i},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),n})()}I(["click"]);const Oe=`<Upload action="/test/file/upload/test" name="file" 
    onProgress={(e: any, file: any, fileList: any[]) => {
        console.log(file);
    }} onSuccess={() => {
        console.log('success');
    }} onError={(e: any) => {
        console.log(e);
    }}>
    <Button icon={<Icon name='upload'/>} type='primary'>Upload Files</Button>
</Upload>`,Te=`<Upload action="/test/file/upload/test" name="file" accept="jpg" 
    defaultFileList={[
        {
            name: 'test.png',
            status: 'finished',
            size: 71183,
            preview: true,
            url: '/test/file/view/test/temp1.png',
        }
    ]}
    onProgress={(e: any, file: any, fileList: any[]) => {
        console.log(file);
    }} onSuccess={() => {
        console.log('success');
    }} onError={(e: any) => {
        console.log(e);
    }}>
    <Button icon={<Icon name='upload'/>} type='primary'>Upload Files</Button>
</Upload>`,qe=`<Space dir="v">
    <Upload action="/test/file/upload/test" name="file" type="drag" data={data()} headers={headers} accept="jpg">
        <div class="cm-upload-drag-wrap">
            <Icon name='upload' size={32}/>
            <p>Click or drag files here to upload</p>
        </div>
    </Upload>
</Space>`,Ie=`<Space dir="v">
    <Upload action="/test/file/upload/test" listType="picture" name="file" data={data()} headers={headers} accept=".jpg,.jpeg" ref={upload}
        defaultFileList={[
            {
                name: 'test.png',
                status: 'finished',
                size: 71183,
                preview: true,
                url: '/test/file/view/test/temp1.png',
            }
        ]}>
            <Icon name='plus1' size={20}/>
    </Upload>
</Space>`,Me=`<Upload action="/test/file/upload/test" name="file" data={data()} headers={headers} accept="jpg" ref={upload}
    defaultFileList={[
        {
            name: 'test.png',
            status: 'finished',
            size: 71183,
            preview: true,
            url: '/test/file/view/test/temp1.png',
        }
    ]}
    onProgress={(e: any, file: any, fileList: any[]) => {
        console.log(file);
    }} onSuccess={() => {
        console.log('success');
    }} onError={(e: any) => {
        console.log(e);
    }}>
        <Button icon={<Icon name='upload'/>} type='primary'>Upload Files</Button>
</Upload>

<Button type='primary' onClick={() => {
console.log(upload.getFileList());
}}>获取文件列表</Button>`,He=[{name:"classList",desc:"自定义class",type:"Object",default:""},{name:"class",desc:"自定义class",type:"string",default:""},{name:"style",desc:"自定义样式",type:"Object",default:""},{name:"action",desc:"上传的地址",type:"string",default:""},{name:"name",desc:"name属性",type:"string",default:""},{name:"multiple",desc:"是否支持多选文件",type:"boolean",default:""},{name:"webkitdirectory",desc:"是否开启选择文件夹，部分浏览器适用",type:"boolean",default:""},{name:"accept",desc:"接受上传的文件类型",type:"string",default:""},{name:"beforeUpload",desc:"上传文件之前的钩子，参数为上传的文件，若返回 false 或者 Promise 则停止上传",type:"Function",default:""},{name:"format",desc:"支持的文件类型，与 accept 不同的是，format 是识别文件的后缀名",type:"string[]",default:""},{name:"maxSize",desc:"文件大小限制，单位b",type:"Number",default:""},{name:"headers",desc:"设置上传的请求头部",type:"Object",default:""},{name:"withCredentials",desc:"支持发送 cookie 凭证信息",type:"boolean",default:""},{name:"data",desc:"上传时附带的额外参数",type:"Object",default:""},{name:"defaultFileList",desc:"默认已上传的文件列表",type:"Array",default:""},{name:"type",desc:"上传控件的类型， select|drag",type:"string",default:"select"},{name:"paste",desc:"是否支持粘贴上传文件",type:"boolean",default:""},{name:"ref",desc:"组件引用",type:"any",default:""},{name:"getFileUrl",desc:"自定义预览的url地址",type:"Function",default:""},{name:"listType",desc:"列表的类型 picture",type:"boolean",default:""},{name:"onProgress",desc:"文件上传时的钩子，返回字段为 event, file, fileList",type:"Function",default:""},{name:"onSuccess",desc:"文件上传成功时的钩子，返回字段为 response, file, fileList",type:"Function",default:""},{name:"onError",desc:"文件上传失败时的钩子，返回字段为 error, file, fileList",type:"Function",default:""},{name:"onRemove",desc:"文件列表移除文件时的钩子，返回字段为 file, fileList",type:"Function",default:""},{name:"onPreview",desc:"点击已上传的文件链接时的钩子，返回字段为 file， 可以通过 file.response 拿到服务端返回数据",type:"Function",default:""},{name:"onFormatError",desc:"文件格式验证失败时的钩子，返回字段为 file, fileList",type:"Function",default:""},{name:"onExceededSize",desc:"文件超出指定大小限制时的钩子，返回字段为 file, fileList",type:"Function",default:""}],Ne=[{name:"onProgress",desc:"文件上传时的钩子",params:"event, file, fileList"},{name:"onSuccess",desc:"文件上传成功时的钩子",params:"response, file, fileList"},{name:"onError",desc:"文件上传失败时的钩子",params:"error, file, fileList"},{name:"onRemove",desc:"文件列表移除文件时的钩子",params:"file, fileList"},{name:"onPreview",desc:"点击已上传的文件链接时的钩子",params:"file"},{name:"onFormatError",desc:"文件格式验证失败时的钩子",params:"file, fileList"},{name:"onExceededSize",desc:"文件超出指定大小限制时的钩子",params:"file, fileList"}],Xe=[{id:"upload_base",text:"基础用法"},{id:"upload_defaultList",text:"默认列表"},{id:"upload_drag",text:"拖拽"},{id:"upload_pictures",text:"照片墙"},{id:"upload_getList",text:"获取列表"},{id:"comp_api",text:"API"},{id:"comp_props",text:"属性"},{id:"comp_events",text:"事件"}],S={upload_base:Oe,upload_defaultList:Te,upload_drag:qe,upload_pictures:Ie,upload_getList:Me},Ge=v('<div class="cm-upload-drag-wrap"><p>Click or drag files here to upload'),Je=v('<div class="sys-ctx-main-left">');function rt(){const[e,o]=q({field:"1"}),f={"x-token":"123456"};let l;return[(()=>{const u=Je();return re(be,u,()=>""),d(u,t(h,{dir:"v",size:32,get children(){return[t(B,{heading:2,children:"Upload 上传"}),t(h,{id:"upload_base",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",onProgress:(r,s,m)=>{console.log(s)},onSuccess:()=>{console.log("success")},onError:r=>{console.log(r)},get children(){return t(x,{get icon(){return t(L,{name:"upload"})},type:"primary",children:"Upload Files"})}}),t(E,{align:"left",get children(){return t(F,{type:"primary",children:"基础用法"})}}),t(C,{type:"secondary",spacing:"extended",children:"基础用法"}),t(b,{get data(){return S.upload_base}})]}})}}),t(h,{id:"upload_defaultList",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",accept:"jpg",defaultFileList:[{name:"test.png",status:"finished",size:71183,preview:!0,url:"https://cqb325.gitee.io/cui-solid-doc/logo.svg"}],onProgress:(r,s,m)=>{console.log(s)},onSuccess:()=>{console.log("success")},onError:r=>{console.log(r)},get children(){return t(x,{get icon(){return t(L,{name:"upload"})},type:"primary",children:"Upload Files"})}}),t(E,{align:"left",get children(){return t(F,{type:"primary",children:"默认列表"})}}),t(C,{type:"secondary",spacing:"extended",children:"defaultFileList 可以初始化默认的列表"}),t(b,{get data(){return S.upload_defaultList}})]}})}}),t(h,{id:"upload_drag",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(h,{dir:"v",get children(){return t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",type:"drag",get data(){return e()},headers:f,accept:"jpg",get children(){const r=Ge(),s=r.firstChild;return d(r,t(L,{name:"upload",size:32}),s),r}})}}),t(E,{align:"left",get children(){return t(F,{type:"primary",children:"拖拽"})}}),t(C,{type:"secondary",spacing:"extended",children:'type="drag" 可以支持拖拽上传， 上传的数据使用data传入， 自定义请求头通过 headers 参数传输'}),t(b,{get data(){return S.upload_drag}})]}})}}),t(h,{id:"upload_pictures",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(h,{dir:"v",get children(){return t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",listType:"picture",name:"file",get data(){return e()},headers:f,accept:".jpg,.jpeg",ref(r){const s=l;typeof s=="function"?s(r):l=r},defaultFileList:[{name:"test.png",status:"finished",size:71183,preview:!0,url:"https://cqb325.gitee.io/cui-solid-doc/logo.svg"}],get children(){return t(L,{name:"plus1",size:20})}})}}),t(E,{align:"left",get children(){return t(F,{type:"primary",children:"照片墙"})}}),t(C,{type:"secondary",spacing:"extended",children:'listType="picture" 文件列表以照片墙的形式展示'}),t(b,{get data(){return S.upload_pictures}})]}})}}),t(h,{id:"upload_getList",dir:"v",get children(){return t(w,{bordered:!0,get children(){return[t(P,{action:"https://cqb325.gitee.io/cui-solid-doc/",name:"file",get data(){return e()},headers:f,accept:"jpg",ref(r){const s=l;typeof s=="function"?s(r):l=r},defaultFileList:[{name:"test.png",status:"finished",size:71183,preview:!0,url:"https://cqb325.gitee.io/cui-solid-doc/logo.svg"}],onProgress:(r,s,m)=>{console.log(s)},onSuccess:()=>{console.log("success")},onError:r=>{console.log(r)},get children(){return t(x,{get icon(){return t(L,{name:"upload"})},type:"primary",children:"Upload Files"})}}),t(x,{type:"primary",onClick:()=>{console.log(l.getFileList())},children:"获取文件列表"}),t(E,{align:"left",get children(){return t(F,{type:"primary",children:"获取列表"})}}),t(C,{type:"secondary",spacing:"extended",children:"通过ref获取upload的引用， 可调用 getFileList 获取文件列表"}),t(b,{get data(){return S.upload_getList}})]}})}}),t(h,{dir:"v",size:24,id:"comp_api",get children(){return[t(B,{type:"primary",heading:3,children:"API"}),t(h,{id:"comp_props",dir:"v",get children(){return[t(B,{type:"primary",heading:4,children:"TimePicker Props"}),t(Z,{columns:we,data:He,border:!0,size:"small"})]}}),t(h,{id:"comp_events",dir:"v",get children(){return[t(B,{type:"primary",heading:4,children:"Events"}),t(Z,{columns:Ee,data:Ne,border:!0,size:"small"})]}})]}})]}})),u})(),t($e,{data:Xe})]}export{rt as default};
